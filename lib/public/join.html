<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Apertura gruppo</title>
  <script>
    (function() {
      // 1) Leggo groupId dalla query string: ?groupId=… 
      function getQueryParam(name) {
        const params = new URLSearchParams(window.location.search);
        return params.get(name);
      }

      const groupId = getQueryParam('groupId');
      if (!groupId) {
        // Se manca il parametro, mostro un messaggio di errore
        document.addEventListener('DOMContentLoaded', () => {
          document.getElementById('status').innerText = 'Parametro groupId mancante.';
        });
        return;
      }

      // 2) COSTRUISCO l’Intent URI per Android:
      //    - scheme = “splitdo”
      //    - host   = “group”
      //    - passaggio di groupId come query (lo stesso schema che hai nel Manifest)
      //    - fallback al Play Store se l’app NON è installata
      const appPackage = 'com.palopoapp.splitdo'; // ← sostituisci con IL TUO package name reale
      const intentUri =
        'intent://group?groupId=' + encodeURIComponent(groupId) +
        '#Intent;' +
          'scheme=splitdo;' +
          'package=' + appPackage + ';' +
          // se l’app non è installata, apre il Play Store:
          'S.browser_fallback_url=' + encodeURIComponent(
            'https://play.google.com/store/apps/details?id=' + appPackage
          ) +
        ';end';

      // 3) Provo subito il redirect all’Intent:
      window.location.replace(intentUri);

      // 4) In ogni caso, entro 1.5 secondi rimbalzo al Play Store:
      setTimeout(() => {
        window.location.replace(
          'https://play.google.com/store/apps/details?id=' + appPackage
        );
      }, 1500);
    })();
  </script>
</head>
<body>
  <h1>Sto aprendo il gruppo…</h1>
  <p id="status">
    Se l’app è installata, si aprirà automaticamente. Altrimenti verrai reindirizzato al Play Store.
  </p>
  <p>
    Se non succede nulla, <a id="manualLink" href="#">clicca qui</a>.
  </p>
  <script>
    // Questo script serve per popolare il link “clicca qui” con lo stesso intentUri,
    // in modo che, se il redirect automatico non funziona, l’utente possa toccare manualmente.
    document.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      const groupId = params.get('groupId');
      if (!groupId) return;

      const appPackage = 'com.palopoapp.splitdo'; // ← lo stesso package name di sopra
      const intentUri =
        'intent://group?groupId=' + encodeURIComponent(groupId) +
        '#Intent;' +
          'scheme=splitdo;' +
          'package=' + appPackage + ';' +
          'S.browser_fallback_url=' + encodeURIComponent(
            'https://play.google.com/store/apps/details?id=' + appPackage
          ) +
        ';end';

      const linkElem = document.getElementById('manualLink');
      if (linkElem) linkElem.href = intentUri;
    });
  </script>
</body>
</html>

